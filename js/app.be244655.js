(function(e){function t(t){for(var o,r,a=t[0],l=t[1],c=t[2],d=0,h=[];d<a.length;d++)r=a[d],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&h.push(i[r][0]),i[r]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(e[o]=l[o]);u&&u(t);while(h.length)h.shift()();return n.push.apply(n,c||[]),s()}function s(){for(var e,t=0;t<n.length;t++){for(var s=n[t],o=!0,a=1;a<s.length;a++){var l=s[a];0!==i[l]&&(o=!1)}o&&(n.splice(t--,1),e=r(r.s=s[0]))}return e}var o={},i={app:0},n=[];function r(t){if(o[t])return o[t].exports;var s=o[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=o,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(s,o,function(t){return e[t]}.bind(null,o));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/library/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],l=a.push.bind(a);a.push=t,a=a.slice();for(var c=0;c<a.length;c++)t(a[c]);var u=l;n.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},1015:function(e,t,s){},1073:function(e,t,s){"use strict";var o=s("7882"),i=s.n(o);i.a},"147e":function(e,t,s){"use strict";var o=s("b11f"),i=s.n(o);i.a},3012:function(e,t,s){e.exports=s.p+"img/no-cover.0e21c760.svg"},"561d":function(e,t,s){"use strict";var o=s("920f"),i=s.n(o);i.a},"56d7":function(e,t,s){"use strict";s.r(t);var o=s("2b0e"),i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("router-view")],1)},n=[],r=(s("7c55"),s("2877")),a={},l=Object(r["a"])(a,i,n,!1,null,null,null),c=l.exports,u=s("8c4f"),d=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:["home",{"has-selected":e.selectedBook,"has-results":e.books.length}]},[s("div",{staticClass:"home__container"},[s("div",{staticClass:"home__book-view"},[s("h1",{staticClass:"home__title"},[e._v("БИБЛИОТЕКА")]),e.selectedBook?s("Book",{attrs:{volume:e.selectedBook,"is-in-favourites":e.isSelectedInFavourites},on:{goBack:function(t){return e.setSelectedBook(null)},toggleMark:e.toggleMark,openFav:e.showFavourites}}):e._e()],1),s("div",{staticClass:"home__search-view"},[e.books===e.favourites?s("div",{staticClass:"home__fav"},[s("button",{staticClass:"home__back",attrs:{type:"button"},on:{click:e.showSearch}}),s("div",{staticClass:"home__fav-text"},[e._v("Избранное")])]):s("div",{staticClass:"home__search-panel"},[s("button",{class:{home__starred:!0,hidden:e.isFocused},attrs:{type:"button"},on:{click:e.showFavourites}},[s("span",{staticClass:"home__starred-tooltip"},[e._v("Избранное")])]),s("SearchSelect",{class:{focused:e.isFocused},attrs:{options:e.selectOptions,required:!1,placeholder:"Поиск","searching-prop":"title"},on:{blur:e.onBlur,error:function(t){e.error=t},focus:function(t){e.isFocused=!0},input:e.debouncedSuggestQuery,change:e.onChange,select:function(t){return e.onChange(t&&t.title)}},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",[e._v("\n              "+e._s(t.option.title)+"\n            ")])]}}]),model:{value:e.searchString,callback:function(t){e.searchString=t},expression:"searchString"}})],1),e.isMobile?s("div",{ref:"searchResults",staticClass:"home__results",on:{scroll:e.debouncedOnScroll}},e._l(e.books,(function(t){return s("VolumeCard",{key:t.id,attrs:{volume:t},on:{click:function(s){return e.showBook(t)}}})})),1):s("div",{ref:"searchResults",staticClass:"home__results"},e._l(e.books,(function(t){return s("VolumeCard",{key:t.id,attrs:{volume:t},on:{click:function(s){return e.showBook(t)}}})})),1),s("paginate",{directives:[{name:"show",rawName:"v-show",value:!e.isMobile&&e.books.length,expression:"!isMobile && books.length"}],attrs:{"page-count":e.totalPages,"page-range":7,"click-handler":e.getPage,"prev-text":"","next-text":"","container-class":"pagination","page-class":"pagination__page","prev-class":"pagination__page prev","next-class":"pagination__page next"},model:{value:e.page,callback:function(t){e.page=t},expression:"page"}})],1)])])},h=[],v=s("2f62"),m=s("bc3a"),p=s.n(m),g=s("2ef0"),_=s("8832"),f=s.n(_),b=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"book"},[s("div",{staticClass:"book__header"},[s("button",{staticClass:"book__back",attrs:{type:"button"},on:{click:function(t){return e.$emit("goBack")}}})]),s("div",{staticClass:"book__top"},[s("div",{staticClass:"book__cover"},[s("img",{staticClass:"book__img",attrs:{src:e.imageSrc,alt:e.volume.volumeInfo.title}})]),s("div",{staticClass:"book__content"},[s("div",{staticClass:"book__title"},[e._v("\n        "+e._s(e.volume.volumeInfo.title)+"\n      ")]),s("div",{staticClass:"book__authors"},[s("span",{staticClass:"book__label"},[e._v("Автор:")]),e._l(e.volume.volumeInfo.authors,(function(t,o){return s("span",{key:t},[s("span",{staticClass:"book__author"},[e._v(e._s(t))]),e._v("\n        "+e._s(e.getComma(o))+"\n    ")])}))],2),e.volume.volumeInfo.publishedDate?s("div",{staticClass:"book__year"},[s("span",{staticClass:"book__label"},[e._v("Год:")]),s("span",{staticClass:"book__value"},[e._v(e._s(e.volume.volumeInfo.publishedDate.substr(0,4)))])]):e._e(),s("div",{staticClass:"book__rating"},[s("Rating",{attrs:{rating:e.volume.volumeInfo.averageRating}}),s("span",{staticClass:"book__label"},[e._v("Рейтинг:")]),s("span",{staticClass:"book__value"},[e._v(e._s(e.volume.volumeInfo.averageRating))])],1),s("div",{staticClass:"book__buttons"},[e.isInFavourites?s("div",{staticClass:"book__two-buttons"},[s("button",{staticClass:"book__add-mark favourite",attrs:{type:"button"},on:{click:function(t){return e.$emit("toggleMark")}}}),s("button",{staticClass:"book__open-fav",attrs:{type:"button"},on:{click:function(t){return e.$emit("openFav")}}},[e._v("Перейти")])]):s("button",{staticClass:"book__add-mark",attrs:{type:"button"},on:{click:function(t){return e.$emit("toggleMark")}}},[e._v("\n          В избранное\n        ")]),s("button",{staticClass:"book__share",attrs:{type:"button"}},[e._v("Поделиться")])])])]),s("div",{staticClass:"book__descr"},[s("div",{staticClass:"book__descr-title"},[e._v("Отрывок книги ")]),e.volume.volumeInfo.description?s("div",{staticClass:"book__descr-text",domProps:{innerHTML:e._s(e.volume.volumeInfo.description)}}):s("div",{staticClass:"book__descr-text"},[e._v("\n      Нет описания\n    ")])])])},k=[],S=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"rating"},e._l(5,(function(t){return s("div",{key:t,staticClass:"rating__star",class:{gold:t<=e.rating,half:t<e.rating&&t+1>e.rating}})})),0)},C=[],y={name:"Rating",props:{rating:{type:Number,default:0}}},w=y,O=(s("147e"),Object(r["a"])(w,S,C,!1,null,"a1ceb08c",null)),I=O.exports,x={name:"Book",components:{Rating:I},props:{volume:{type:Object,default(){return{}}},isInFavourites:{type:Boolean,default:!1}},computed:{imageSrc(){const{imageLinks:e}=this.volume&&this.volume.volumeInfo;return e?e.medium?e.medium:e.thumbnail:"../assets/images/no-cover.svg"}},data(){return{googleUser:{},userId:"",shelves:[]}},methods:{getComma(e){return e<this.volume.volumeInfo.authors.length-1?",":""}}},B=x,F=(s("c2ba"),Object(r["a"])(B,b,k,!1,null,"6ccd52d3",null)),P=F.exports,$=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{class:["search-select",{open:e.isOpen&&e.hasSuggesstions,"has-text":e.searchingValue}]},[s("label",[s("span",[e._v(e._s(e.label))]),s("input",{staticClass:"search-select__input",attrs:{placeholder:e.placeholder},domProps:{value:e.searchingValue},on:{blur:e.onBlur,focus:e.onFocus,input:e.onInput,change:e.onChange,keydown:e.onKeydown}})]),s("button",{staticClass:"search-select__clear",attrs:{type:"button"},on:{click:e.onClear}}),s("div",{class:["search-select__dropdown",{visible:e.isOpen&&e.hasSuggesstions}],attrs:{tabindex:"0"},on:{blur:e.closeDropdown,scroll:function(t){e.isScrolling=!0}}},e._l(e.filteredOptions,(function(t,o){return s("div",{key:o,class:["search-select__item"],on:{mousedown:function(s){return e.select(t)}}},[e._t("default",[e._v("\n        "+e._s(t)+"\n      ")],{option:t})],2)})),0)])},j=[];function E(e,t){const s=t.split(".");let o=e;for(let i=0;i<s.length;++i){if(!o[s[i]])return o[s[i]];o=o[s[i]]}return o}var L={model:{prop:"searchingValue",event:"input"},props:{label:{type:String,default:""},searchingValue:{type:String,default:""},searchingProp:{type:String,default:""},options:{type:Array,default(){return[]}},required:{type:Boolean,default:!0},placeholder:{type:String,default:""},maxLength:{type:Number,default:255}},data(){return{isScrolling:!1,isOpen:!1,rules:{maxLength:e=>!e||e.length<=this.maxLength},selected:null,isFocused:!1}},computed:{filteredOptions(){if(!this.searchingValue||!this.options)return[];const e=this.searchingValue.trim().toLowerCase();return this.searchingProp?this.options.filter(t=>E(t,this.searchingProp).toLowerCase().includes(e)):this.options.filter(t=>t.toLowerCase().includes(e))},hasSuggesstions(){return this.filteredOptions&&this.filteredOptions.length}},methods:{closeDropdown(){this.isOpen=!1,this.isScrolling=!1},onBlur(e){this.validate(e.target.value),this.$emit("blur",e),setTimeout(()=>{this.isScrolling||this.closeDropdown()},50)},onClear(){this.$emit("input","")},onChange(){this.closeDropdown()},onFocus(){this.$emit("focus"),this.showDropdown()},onInput(e){const{value:t}=e.target;this.isOpen=!0,this.validate(t),this.$emit("input",t)},onKeydown(e){"Enter"===e.code&&this.$emit("change",e.target.value)},select(e){this.closeDropdown(),this.$emit("select",e)},validate(e){return this.required&&!e?(this.$emit("error","Необходимо заполнить все обязательные поля"),!1):this.rules.maxLength(e)?(this.$emit("error",""),!0):(this.$emit("error","Слишком длинный текст"),!1)},showDropdown(){this.searchingValue&&this.filteredOptions.length&&(this.isOpen=!0)}}},M=L,R=(s("561d"),Object(r["a"])(M,$,j,!1,null,null,null)),T=R.exports,V=function(){var e=this,t=e.$createElement,o=e._self._c||t;return e.volume.volumeInfo?o("div",{staticClass:"volume-card",on:{click:function(t){return e.$emit("click")}}},[o("div",{staticClass:"volume-card__left"},[e.volume.volumeInfo.imageLinks?o("img",{staticClass:"volume-card__img",attrs:{src:e.volume.volumeInfo.imageLinks.thumbnail,alt:e.volume.volumeInfo.title}}):o("img",{staticClass:"volume-card__img",attrs:{src:s("3012"),alt:e.volume.volumeInfo.title}})]),o("div",{staticClass:"volume-card__right"},[o("div",{staticClass:"volume-card__rate"},[o("Rating",{attrs:{rating:e.volume.volumeInfo.averageRating}})],1),o("div",{staticClass:"volume-card__title"},[e._v("\n      "+e._s(e.volume.volumeInfo.title)+"\n    ")]),o("div",{class:["volume-card__description",{empty:!e.volume.volumeInfo.description}]},[e._v("\n      "+e._s(e.volume.volumeInfo.description?e.volume.volumeInfo.description:"Нет описания")+"\n    ")])])]):e._e()},q=[],A={name:"VolumeCard",components:{Rating:I},props:{volume:{type:Object,default(){return{}}}}},D=A,U=(s("1073"),Object(r["a"])(D,V,q,!1,null,null,null)),G=U.exports,Q={name:"home",components:{Book:P,SearchSelect:T,VolumeCard:G,Paginate:f.a},data(){return{searchString:"",error:"",selectOptions:[],books:[],script:null,isFocused:!1,startIndex:0,listElement:null,lastSearchParams:"",lastSearchedString:"",viewportWidth:0,maxResults:5,threshold:200,page:0,totalPages:0,lastBooks:[]}},computed:{...Object(v["e"])(["selectedBook","userId","favourites"]),...Object(v["c"])(["isSelectedInFavourites"]),isMobile(){return document.documentElement.clientWidth<1280}},created(){window.setQueryOptions=e=>{this.selectOptions=e&&e[1].map(e=>({title:e[0]})),this.script&&document.body.removeChild(this.script)},this.debouncedSuggestQuery=Object(g["debounce"])(this.suggestQuery,450),this.debouncedOnScroll=Object(g["debounce"])(this.onScroll,100)},mounted(){this.listElement=this.$el&&this.$el.querySelector(".home__results"),this.getUserFavourites()},methods:{...Object(v["d"])(["setUserId","setSelectedBook"]),...Object(v["b"])(["loadAndSetSelectedBook","loadFavorites","addToFavourites","removeFromFavourites"]),onBlur(){this.isFocused=!1,this.findBooks()},onChange(e){this.searchString=e;const t=e&&e.trim()||"";t&&this.findBooks()},onScroll(){if("home"===this.$route.name&&this.isMobile&&this.books!==this.favourites){const e=this.listElement;e.scrollHeight-e.scrollTop-this.threshold<=e.clientHeight&&(this.startIndex+=this.maxResults,this.findBooks())}},suggestQuery(e){const t=e&&e.trim()||"";this.searchString=e,t&&(this.script=document.createElement("script"),this.script.src=`https://suggestqueries.google.com/complete/search?ds=bo&client=books&callback=setQueryOptions&q=${e}`,document.body.appendChild(this.script))},findBooks(){const e=`https://www.googleapis.com/books/v1/volumes?key=AIzaSyAYqnQuRmbz4Cs5gdGpx_pr4tKd5y8WOTk&q=${this.searchString}&startIndex=${this.startIndex}&maxResults=${this.maxResults}`;this.searchString&&e!==this.lastSearchParams&&(this.lastSearchedString!==this.searchString&&(this.lastSearchedString=this.searchString,this.books=[]),this.lastSearchParams=e,p.a.get(e).then(e=>{const{data:t}=e;this.totalPages=Math.ceil(t.totalItems/this.maxResults),this.searchString.includes(this.lastSearchedString)&&this.books.push(...t.items)}))},getPage(){this.startIndex=(this.page-1)*this.maxResults,this.findBooks()},showBook(e){this.loadAndSetSelectedBook(e)},toggleMark(){this.isSelectedInFavourites?this.removeFromFavourites(this.selectedBook):this.addToFavourites(this.selectedBook)},getUserFavourites(){const{gapi:e,GoogleAuth:t,GOOGLE_O_AUTH_SCOPE:s}=window;e&&t?e.client.request({method:"GET",path:"/books/v1/mylibrary/bookshelves",scope:s}).then(({result:e})=>{const{items:t}=e,s=t&&t[0]||null;if(s){const e=s.selfLink&&s.selfLink.split("/")[6]||0;this.setUserId(e)}return!0}).catch(({result:e})=>{console.error(e&&e.error)}).then(this.loadFavorites).catch(e=>{console.error(e)}):setTimeout(this.getUserFavourites,2e3)},showFavourites(){this.isMobile&&(this.setSelectedBook(null),this.lastBooks=this.books),this.books=this.favourites},showSearch(){this.books=this.lastBooks}}},H=Q,K=(s("de16"),Object(r["a"])(H,d,h,!1,null,null,null)),N=K.exports;o["a"].use(u["a"]);var W=new u["a"]({routes:[{path:"/",name:"home",component:N}]});o["a"].use(v["a"]);var z=new v["a"].Store({state:{selectedBook:null,userId:0,favourites:[]},getters:{isSelectedInFavourites(e){return!(!e.selectedBook||!e.favourites.length)&&e.favourites.some(t=>t.id===e.selectedBook.id)}},mutations:{setSelectedBook(e,t){e.selectedBook=t},setUserId(e,t){e.userId=t},setFavourites(e,t){e.favourites=t},addFavourite(e,t){e.favourites.push(t)},removeFavourite(e,t){const s=e.favourites.findIndex(e=>e.id===t.id);s>-1&&e.favourites.splice(s,1)}},actions:{loadAndSetSelectedBook({commit:e},t){return t&&t.selfLink?p.a.get(t.selfLink).then(({data:t})=>e("setSelectedBook",t)):Promise.reject()},addToFavourites({commit:e},t){const s=window.gapi||null;return s&&t.id?s.client.request({method:"POST",path:"/books/v1/mylibrary/bookshelves/0/addVolume",params:{volumeId:t.id}}).then(s=>{return e("addFavourite",t),s}):Promise.reject()},removeFromFavourites({commit:e},t){const s=window.gapi||null;return s&&t.id?s.client.request({method:"POST",path:"/books/v1/mylibrary/bookshelves/0/removeVolume",params:{volumeId:t.id}}).then(s=>{return e("removeFavourite",t),s}):Promise.reject()},loadFavorites({commit:e}){const t=window.gapi||null,{GOOGLE_O_AUTH_SCOPE:s}=window;return t?t.client.request({method:"GET",path:"/books/v1/mylibrary/bookshelves/0/volumes",scope:s}).then(({result:t})=>{const{items:s=[]}=t;return e("setFavourites",s),!0}):Promise.reject()}}});o["a"].config.productionTip=!1,new o["a"]({router:W,store:z,render(e){return e(c)}}).$mount("#app")},"5c48":function(e,t,s){},7882:function(e,t,s){},"7c55":function(e,t,s){"use strict";var o=s("5c48"),i=s.n(o);i.a},"920f":function(e,t,s){},b11f:function(e,t,s){},c2ba:function(e,t,s){"use strict";var o=s("1015"),i=s.n(o);i.a},de16:function(e,t,s){"use strict";var o=s("f3e7"),i=s.n(o);i.a},f3e7:function(e,t,s){}});
//# sourceMappingURL=app.be244655.js.map